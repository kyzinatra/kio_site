import{u as U,a as u,j as s,c as b,r as f}from"./index-4fc40948.js";import{u as k,Q as v,m as I,a as M,_ as C,E as w,b as h,c as R,T as P,d as q,B as N,C as V,e as $,L as A}from"./layout.component-a6c77085.js";import{F as B,R as T,I as j,U as D}from"./user-connections-b75135ff.js";const G=`${M}/SIGN_UP_QUERY`;async function H(e){return I(G,{body:e})}const O=()=>{const e=U();return k({mutationKey:[v.SIGN_UP],mutationFn:H,retry:1,onSuccess:()=>{e.invalidateQueries([v.ME])}})};var x,g;function Q(e,t){return!(e===t||u.isValidElement(e)&&u.isValidElement(t)&&e.key!=null&&e.key===t.key)}var m={out:"out-in",in:"in-out"},y=function(t,n,r){return function(){var o;t.props[n]&&(o=t.props)[n].apply(o,arguments),r()}},L=(x={},x[m.out]=function(e){var t=e.current,n=e.changeState;return u.cloneElement(t,{in:!1,onExited:y(t,"onExited",function(){n(h,null)})})},x[m.in]=function(e){var t=e.current,n=e.changeState,r=e.children;return[t,u.cloneElement(r,{in:!0,onEntered:y(r,"onEntered",function(){n(h)})})]},x),Y=(g={},g[m.out]=function(e){var t=e.children,n=e.changeState;return u.cloneElement(t,{in:!0,onEntered:y(t,"onEntered",function(){n(w,u.cloneElement(t,{in:!0}))})})},g[m.in]=function(e){var t=e.current,n=e.children,r=e.changeState;return[u.cloneElement(t,{in:!1,onExited:y(t,"onExited",function(){r(w,u.cloneElement(n,{in:!0}))})}),u.cloneElement(n,{in:!0})]},g),E=function(e){C(t,e);function t(){for(var r,o=arguments.length,c=new Array(o),i=0;i<o;i++)c[i]=arguments[i];return r=e.call.apply(e,[this].concat(c))||this,r.state={status:w,current:null},r.appeared=!1,r.changeState=function(a,l){l===void 0&&(l=r.state.current),r.setState({status:a,current:l})},r}var n=t.prototype;return n.componentDidMount=function(){this.appeared=!0},t.getDerivedStateFromProps=function(o,c){return o.children==null?{current:null}:c.status===h&&o.mode===m.in?{status:h}:c.current&&Q(c.current,o.children)?{status:R}:{current:u.cloneElement(o.children,{in:!0})}},n.render=function(){var o=this.props,c=o.children,i=o.mode,a=this.state,l=a.status,d=a.current,p={children:c,current:d,changeState:this.changeState,status:l},S;switch(l){case h:S=Y[i](p);break;case R:S=L[i](p);break;case w:S=d}return u.createElement(P.Provider,{value:{isMounting:!this.appeared}},S)},t}(u.Component);E.propTypes={};E.defaultProps={mode:m.out};const z=E,K="_radio_1ys8k_1",X="_radio__select_1ys8k_31",J="_radio__title_1ys8k_41",W="_radio__description_1ys8k_47",Z="_radio__input_1ys8k_67",_={radio:K,radio__select:X,radio__title:J,radio__description:W,radio__input:Z},ee=({checked:e=!1,children:t,title:n,name:r,value:o,onChange:c})=>s.jsxs("label",{className:b(_.radio,{[_.radio__select]:e}),children:[s.jsxs("div",{className:_.radio__content,children:[s.jsx("h2",{className:_.radio__title,children:n}),s.jsx("p",{className:_.radio__description,children:t})]}),s.jsx("input",{type:"radio",checked:e,value:o,onChange:c,name:r,className:_.radio__input})]}),te=[{title:"Участник",content:"Я буду участвовать в конкурсе. Ученик школы, гимназии или лицея.  "},{title:"Организатор или учитель",content:"Я хочу создать, организовать или курировать конкурс. "}],ne={"sign-up-select":"_sign-up-select_yw937_1 _form-width_esyqq_11"},re="_radio__container_sxv1n_1",se={radio__container:re},ae=({children:e,name:t,onChange:n,value:r})=>{const[o,c]=f.useState(r);f.useEffect(()=>{o!==r&&c(r||"")},[r]);function i(a){c(a.target.value),n==null||n(a.target.value)}return s.jsx("div",{className:se.radio__container,children:u.Children.map(e,a=>u.cloneElement(a,{name:t,...a.props,onChange:i,checked:o===a.props.value}))})},oe=({children:e,...t})=>s.jsx(B,{name:t.name,children:({input:n})=>s.jsx(ae,{...t,...n,children:e})}),ie=({onSubmit:e,baseForm:t})=>{const n=q(),r=o=>{const{email:c,role:i}=o;if(!c||!i){n.push({title:"Форма не заполнена до конца",theme:"error"});return}e({email:c,role:i})};return s.jsx(T,{onSubmit:r,initialValues:t,children:({handleSubmit:o})=>s.jsxs("form",{onSubmit:o,className:ne["sign-up-select"],children:[s.jsx(oe,{name:"role",children:te.map(({title:c,content:i})=>s.jsx(ee,{title:c,value:c,children:i},c))}),s.jsx(j,{stretch:!0,placeholder:"Электронная почта",name:"email",type:"email",required:!0}),s.jsx(N,{stretch:!0,theme:"accent",type:"submit",children:"Продолжить"})]})})},ce={"sign-up":"_sign-up_1dflh_1 _center-page_esyqq_19 _full-height-form_esyqq_1"};const ue="_swapper__container_msyf5_1",le={swapper__container:ue},de=({children:e,view:t})=>{const n=f.useMemo(()=>Array.from({length:e.length}).map(()=>u.createRef()),[e.length]);return s.jsx(z,{children:s.jsx(V,{classNames:"swapper",timeout:$,nodeRef:n[t],children:s.jsx("div",{ref:n[t],className:le.swapper__container,children:e[t]})},t)})};function pe(e){return e.split(" ").map(t=>t.length===0?t:t[0].toUpperCase()+t.slice(1).toLowerCase()).join(" ")}const F={"sign-up-form":"_sign-up-form_140fu_1 _form-width_esyqq_11 _center-page_esyqq_19","sign-up-form__buttons":"_sign-up-form__buttons_140fu_17"},_e={password:"",fullName:"",passwordRepeat:""},me=({onSubmit:e,goBack:t,isLoading:n})=>{const r=q(),o=i=>{if(i.password!==i.passwordRepeat)return r.push({title:"Пароли не совпадают",theme:"error"}),{password:!0,passwordRepeat:!0};const a=i.fullName.split(" ").filter(Boolean);if(!a||a.length<2)return r.push({title:"Введите полное имя",theme:"error"}),{fullName:!0};e({password:i.password||"",name:a[1]||"",surname:a[0]||"",patronymic:a[2]||""})},c=i=>pe(i);return s.jsx(T,{onSubmit:o,initialValues:_e,children:({handleSubmit:i,submitErrors:a,dirtySinceLastSubmit:l,...d})=>s.jsxs("form",{onSubmit:i,className:F["sign-up-form"],children:[s.jsx(D,{children:"Зарегистрироваться через социальные сети"}),s.jsx("h2",{children:"Или создайте вручную"}),s.jsx(j,{required:!0,placeholder:"Ваше ФИО",stretch:!0,autoComplete:"name",name:"fullName",disabled:n,isError:(a==null?void 0:a.fullName)&&!l,mutate:c}),s.jsx(j,{required:!0,type:"password",pattern:".{6,}",title:"Шесть или более символов",placeholder:"Пароль",stretch:!0,disabled:n,name:"password",isError:(a==null?void 0:a.password)&&!l,autoComplete:"new-password"}),s.jsx(j,{required:!0,type:"password",pattern:".{6,}",title:"Шесть или более символов",autoComplete:"new-password",name:"passwordRepeat",disabled:n,isError:(a==null?void 0:a.passwordRepeat)&&!l,placeholder:"Повтор пароля",stretch:!0}),s.jsxs("div",{className:F["sign-up-form__buttons"],children:[s.jsx(N,{onClick:t,disabled:n,type:"button",children:"Назад"}),s.jsx(N,{theme:"accent",disabled:n,type:"submit",stretch:!0,children:"Завершить регистрацию"})]})]})})},xe=()=>{const[e,t]=f.useState({}),[n,r]=f.useState(0),o=O(),c=d=>{t(p=>({...p,...d})),r(p=>++p)},i=d=>{o.mutate({...e,...d})},a=()=>{r(d=>--d)},l={email:e.email||"",role:e.role||""};return s.jsx(A,{protectedFrom:"authorized",withHelp:!0,children:s.jsx("main",{className:ce["sign-up"],children:s.jsxs(de,{view:n,children:[s.jsx(ie,{onSubmit:c,baseForm:l}),s.jsx(me,{onSubmit:i,isLoading:o.isLoading,goBack:a})]})})})};export{xe as SignUp};
